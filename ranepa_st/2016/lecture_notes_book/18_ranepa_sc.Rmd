# Решение задач по теме Мартингалы {#safes_and_keys_problem}

Конспект: Титова Алиса

дата: 18 ноября 2016

## Задача про сейфы и ключи (10.58 в задачнике)

### Условие задачи:

Представим, что у нас есть 94 сейфа и 94 ключа от этих сейфов. Каждый ключ может открыть только 1 сейф, и каждый сейф может быть открыт только одним ключом. Ключи в случайном порядке размещены в сейфах: один сейф содержит один ключ. Пусть, кроме того, 92 сейфа закрыты, а два оставшихся открыты и содержат в себе 2 случайных ключа (не обязательно от этих двух сейфов). Какова вероятность того, что можно открыть все сейфы с помощью двух имеющихся ключей?

### Решение без мартингалов:

![Иллюстрация к условию.](https://pp.vk.me/c626521/v626521672/3cecf/G0qlkcB1bzY.jpg)

Пусть всего n = 94 сейфа. Пусть также $p_k$ - это вероятность открыть все сейфы, имея k ключей на старте. Согласно условию задачи, нам надо найти $p_2$. Чтобы понять принцип решения, сначала найдем тривиальные вещи. Например, чему будет равно $p_0$? Ясно, что, имея изначально 0 ключей, вероятность открыть все сейфы равна 0. Следовательно, $p_0 = 0$. Найдем теперь, чему равна $p_{94}$, то есть вероятность открыть все 94 сейфа имея все 94 ключа от них. Очевидно, что эта вероятность равна 1, то есть $p_{94} = 1$.

Перейдем к более интересным случаям. Определим, что скрывается, например, за $p_{93}$? $P_{93}$ - это вероятность открыть все 94 сейфа, имея при себе 93 ключа. Казалось бы, разломав 93 сейфа и достав из них 93 ключа, один из них почти наверняка будет подходить к единственному закрытому сейфу. Ключевое слово здесь - почти. Если мы вполне умелые (для того, чтобы разбить 93 сейфа без лишнего шума), однако, не особо удачливые жулики (например, как персонажи книг и фильмов "Двенадцать стульев") то может так случиться, что 94-ый неразбитый нами сейф содержит в себе ключ от себя же. Вероятность этого события крайне мала, но она есть и равняется  $\frac {1}{94}$. Как следствие, вероятность того, что проделанная нами работа по "раскурочиванию" 93 сейфов привела к успеху и среди вытащенных на свет 93-ёх ключей всё таки находится ключ к 94 сейфу равна 1 - $\frac {1}{94}$  = $\frac {93}{94}$.

Теперь, разобрав простые случаи, попытаемся отыскать вероятность того, что, разбив 92 сейфа и имея на руках 92 ключа, можно открыть 2 неоткрытых сейфа (то есть $p_{92}$). Пойдем от противного: в каких случаях, имея 92 ключа, мы не сможем открыть оставшиеся сейфы? Таких случаев 3 и они все в схематичном виде представлены на картинке ниже.

![](https://pp.vk.me/c626521/v626521672/3cec7/q5H2CF9qjuQ.jpg)

* Случай номер 1: Когда каждый сейф содержит в себе ключ от себя же. Вероятность этого события равна $\frac {1}{94}$. В данном случае, считая вероятность, мы учитываем только то, что лишь один сейф содержит ключ, открывающий себя. Этого достаточно, чтобы имея 92 ключа, мы не смогли открыть оставшиеся 2 сейфа.

* Случай номер 2: Ключи в двух сейфах расположены крест на крест, то есть первый содержит ключ от второго, а второй - от первого. Вероятность этого равна $\frac {1}{94} * \frac {1}{93}$. Знаменатель второго множителя равен 93, потому что речь идёт о разных ключах (один ключ уже "использован" и находится в одном из двух закрытых сейфов). 

* Случай номер 3: Один из сейфов содержит ключ от себя же, а во втором находится ключ от одного из 92 разбитых сейфов. Вероятность того, что ключ в первом неразбитом сейфе ведет к одному из 92-ух разбитых равна $\frac {92}{94}$. А вероятность того, что ключ во втором неразбитом сейфе (при условии, что один из 94 ключей уже использован и ведет к разбитому сейфу) ведёт сам в себя равна $\frac {1}{93}$. Следовательно, вероятность события, состоящего в том, что {один из сейфов содержит ключ от себя же, а во втором находится ключ от одного из 92 разбитых сейфов} равна $\frac {92}{94} * \frac {1}{93}$.

Теперь, рассмотрев детально каждый из трёх случаев, совсем просто вычислить, чему равна вероятность того, что, имея 92 ключа на руках, мы сможем открыть оставшиеся два сейфа. Вероятность этого противоположного события равна: 

\begin{gather}
p_{92} = 1 - \frac {1}{94} -\frac {92}{94} *  \frac {1}{93} - \frac {1}{94}*\frac {1}{93} = \frac {92}{94} \notag
\end{gather}

В процессе этого рассуждения появляется догадка. А что, если $p_{k,n}$ = $\frac {k}{n}$? То есть вероятность того, что, имея k ключей, мы сможем открыть (n-k) из n сейфов равняется $\frac {k}{n}$.
Ну что ж, давайте проверим, верна ли эта догадка.

Пусть у нас имеетя всего n сейфов и в каждом содержится по одному ключу. Представим также, что у нас есть большая дубинка, которой можно легко разбить k сейфов и вытащить из них k ключей. Рассмотрим первый из k ключей. С вероятностью $\frac {k}{n}$ этот ключ будет бесполезным, то есть он будет вести к одному из k уже разбитых сейфов. В этом случае его можно выкинуть и считать, что и ключей и сейфов на один меньше. Это событие можно записать как $p_{k-1,n-1}$. 
С другой стороны, с вероятностью 1 - $\frac {k}{n}$ рассматриваемый нами ключ будет полезным, то есть он будет вести к одному из (n-k) неразбитых сейфов. Тогда число имеющихся у нас ключей равняется числу открытых сейфов и равняется k, а общее число сейфов уменьшилось на 1 (их стало n-1). Следовательно, это событие можно записать как $p_{k,n-1}$.

Теперь остаётся только объединить наши рассуждения в одно уравнение и убедиться, что догадка, высказнная ранее, подходит к этому уравнению, то есть приводит к верному равенству.

\begin{gather}
p_{k,n} = \frac {k}{n} = \frac {k}{n} * p_{k-1,n-1} + \frac {n-k}{n} * p_{k,n-1}\\
\frac {k}{n} = \frac {k}{n} * \frac {k-1}{n-1} + \frac {n-k}{n} * \frac {k} {n-1}\\
\frac {1}{n} =\frac {1}{n} * \frac {k-1}{n-1} + \frac {n-k}{n} * \frac{1}{n-1}\\
\frac {1}{n} =  \frac {1}{n(n-1)} * (k-1+n-k) = \frac {1}{n} \notag
\end{gather}

Приведенные вычисления показывают, что наша догадка верна, и что, имея k ключей, вероятность открыть все n сейфов равняется $\frac {k}{n}$. Значит, имея два ключа, мы сможем открыть все 94 сейфа с вероятностью $\frac {2}{94}$ или $\frac {1}{47}$. Это и есть ответ на вопрос задачи.

![Известные многим с детства, но, возможно, не самые удачливые жулики, о которых шла речь выше.](http://content.foto.mail.ru/mail/bmw7.08/_animated/i-7656.gif)

## P.S.
Надо сказать, что 18 ноября мы оказались самыми удачливыми студентами, так как нам досталась аудитория, идеально подходящая для того, чтобы съесть пиццу в приятной товарищеской атмосфере. Это послужило весомым поводом заказать пиццу прямо в аудиторию, что Борис Борисович и сделал, к изумлению всех собравшихся. Спасибо ему за это!
